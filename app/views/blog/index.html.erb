<% content_for :title, @meta_tags[:title] if @meta_tags[:title] %>

<div class="container mx-auto px-4 py-8">
  <!-- Blog Header -->
  <div class="text-center mb-12">
    <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
      ShikshaGuru Blog
    </h1>
    <p class="text-xl text-gray-600 max-w-2xl mx-auto">
      Discover educational insights, teaching tips, and learning resources to enhance your educational journey.
    </p>
  </div>

  <!-- Search Bar -->
  <div class="max-w-2xl mx-auto mb-12">
    <%= form_with url: blog_search_path, method: :get, local: true, 
                  html: { class: 'flex gap-2' } do |f| %>
      <%= f.text_field :q, 
                      value: params[:q],
                      placeholder: "Search articles...",
                      class: "flex-1 input input-bordered input-lg" %>
      <%= f.submit "Search", class: "btn btn-primary btn-lg" %>
    <% end %>
  </div>

  <!-- Featured Posts -->
  <% if @featured_posts.any? %>
    <section class="mb-16">
      <h2 class="text-3xl font-bold text-gray-900 mb-8">Featured Articles</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <% @featured_posts.each do |post| %>
          <article class="card bg-base-100 shadow-lg hover:shadow-xl transition-shadow">
            <figure class="aspect-video">
              <%= link_to blog_post_path(post.slug) do %>
                <%= blog_post_featured_image(post, 
                                           class: "w-full h-full object-cover",
                                           alt: post.title) %>
              <% end %>
            </figure>
            <div class="card-body">
              <div class="flex flex-wrap gap-1 mb-2">
                <% post.blog_categories.each do |category| %>
                  <%= blog_category_badge(category) %>
                <% end %>
              </div>
              
              <h3 class="card-title text-lg hover:text-primary transition-colors">
                <%= link_to post.title, blog_post_path(post.slug) %>
              </h3>
              
              <p class="text-gray-600 text-sm mb-4">
                <%= blog_post_excerpt(post, 120) %>
              </p>
              
              <div class="flex items-center justify-between text-sm text-gray-500">
                <div class="flex items-center space-x-2">
                  <%= blog_author_avatar(post) %>
                  <span><%= post.author_name %></span>
                </div>
                <div class="flex items-center space-x-4">
                  <span><%= format_publish_date(post.published_at, :short) %></span>
                  <span><%= blog_post_reading_time(post) %> read</span>
                </div>
              </div>
            </div>
          </article>
        <% end %>
      </div>
    </section>
  <% end %>

  <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
    <!-- Main Content -->
    <div class="lg:col-span-3">
      <!-- Filters -->
      <div class="flex flex-wrap items-center justify-between mb-8">
        <div class="flex flex-wrap gap-2 mb-4 lg:mb-0">
          <%= link_to "All Posts", blog_index_path,
                     class: "btn btn-sm #{'btn-primary' if params[:category].blank? && params[:tag].blank?}" %>
          
          <% @popular_categories.each do |category| %>
            <%= link_to category.name, blog_category_path(category.slug),
                       class: "btn btn-sm #{'btn-primary' if params[:category] == category.slug}" %>
          <% end %>
        </div>
        
        <div class="flex items-center space-x-2">
          <span class="text-sm text-gray-600">Sort:</span>
          <%= form_with url: request.path, method: :get, local: true, 
                        html: { class: 'flex items-center space-x-2' } do |f| %>
            <% params.except(:sort).each do |key, value| %>
              <%= f.hidden_field key, value: value %>
            <% end %>
            <%= f.select :sort, 
                        options_for_select([
                          ['Latest', ''],
                          ['Oldest', 'oldest'],
                          ['Most Popular', 'popular'],
                          ['Title A-Z', 'title']
                        ], params[:sort]),
                        {},
                        { 
                          class: "select select-sm select-bordered",
                          onchange: "this.form.submit();"
                        } %>
          <% end %>
        </div>
      </div>

      <!-- Blog Posts Grid -->
      <% if @blog_posts.any? %>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
          <% @blog_posts.each do |post| %>
            <article class="card bg-base-100 shadow-md hover:shadow-lg transition-shadow">
              <figure class="aspect-video">
                <%= link_to blog_post_path(post.slug) do %>
                  <%= blog_post_featured_image(post, 
                                             class: "w-full h-full object-cover",
                                             alt: post.title) %>
                <% end %>
              </figure>
              <div class="card-body">
                <div class="flex flex-wrap gap-1 mb-2">
                  <% post.blog_categories.each do |category| %>
                    <%= blog_category_badge(category) %>
                  <% end %>
                </div>
                
                <h3 class="card-title hover:text-primary transition-colors">
                  <%= link_to post.title, blog_post_path(post.slug) %>
                </h3>
                
                <p class="text-gray-600 mb-4">
                  <%= blog_post_excerpt(post) %>
                </p>
                
                <div class="flex items-center justify-between text-sm text-gray-500">
                  <div class="flex items-center space-x-2">
                    <%= blog_author_avatar(post) %>
                    <span><%= post.author_name %></span>
                  </div>
                  <div class="flex items-center space-x-4">
                    <span><%= format_publish_date(post.published_at, :short) %></span>
                    <span><%= blog_post_reading_time(post) %> read</span>
                    <span class="flex items-center">
                      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                      </svg>
                      <%= post.views_count %>
                    </span>
                  </div>
                </div>
                
                <!-- Tags -->
                <% if post.blog_tags.any? %>
                  <div class="flex flex-wrap gap-1 mt-3">
                    <% post.blog_tags.limit(3).each do |tag| %>
                      <%= blog_tag_link(tag) %>
                    <% end %>
                    <% if post.blog_tags.count > 3 %>
                      <span class="text-xs text-gray-500">+<%= post.blog_tags.count - 3 %> more</span>
                    <% end %>
                  </div>
                <% end %>
              </div>
            </article>
          <% end %>
        </div>

        <!-- Pagination -->
        <div class="flex justify-center">
          <%= paginate @blog_posts %>
        </div>
      <% else %>
        <!-- No Posts -->
        <div class="text-center py-16">
          <svg class="mx-auto h-24 w-24 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9.5a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/>
          </svg>
          <h3 class="text-2xl font-medium text-gray-900 mt-4">No articles found</h3>
          <p class="text-gray-500 mt-2">
            <% if params[:query].present? %>
              No articles match your search for "<%= params[:query] %>".
            <% else %>
              There are no published articles yet.
            <% end %>
          </p>
          <%= link_to "View All Articles", blog_index_path, class: "btn btn-primary mt-4" %>
        </div>
      <% end %>
    </div>

    <!-- Sidebar -->
    <div class="lg:col-span-1">
      <div class="space-y-8">
        <!-- Popular Posts Widget -->
        <div class="card bg-base-100 shadow-md">
          <div class="card-body">
            <h3 class="card-title text-lg mb-4">Popular Articles</h3>
            <div class="space-y-4">
              <% popular_posts_widget.each do |post| %>
                <div class="flex space-x-3">
                  <div class="flex-shrink-0">
                    <%= link_to blog_post_path(post.slug) do %>
                      <%= blog_post_featured_image(post, class: "w-16 h-16 object-cover rounded") %>
                    <% end %>
                  </div>
                  <div class="flex-1 min-w-0">
                    <h4 class="text-sm font-medium hover:text-primary transition-colors">
                      <%= link_to post.title.truncate(60), blog_post_path(post.slug) %>
                    </h4>
                    <p class="text-xs text-gray-500 mt-1">
                      <%= format_publish_date(post.published_at, :short) %> â€¢ <%= post.views_count %> views
                    </p>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <!-- Categories Widget -->
        <div class="card bg-base-100 shadow-md">
          <div class="card-body">
            <h3 class="card-title text-lg mb-4">Categories</h3>
            <div class="space-y-2">
              <% categories_widget.each do |category| %>
                <div class="flex items-center justify-between">
                  <%= link_to category.name, blog_category_path(category.slug),
                             class: "text-sm hover:text-primary transition-colors" %>
                  <span class="text-xs text-gray-500"><%= category.posts_count %></span>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <!-- Tags Widget -->
        <div class="card bg-base-100 shadow-md">
          <div class="card-body">
            <h3 class="card-title text-lg mb-4">Popular Tags</h3>
            <div class="flex flex-wrap gap-2">
              <% tags_widget.each do |tag| %>
                <%= blog_tag_link(tag) %>
              <% end %>
            </div>
          </div>
        </div>

        <!-- Newsletter Signup -->
        <div class="card bg-primary text-primary-content shadow-md">
          <div class="card-body">
            <h3 class="card-title text-lg mb-2">Stay Updated</h3>
            <p class="text-sm opacity-90 mb-4">
              Get the latest educational insights delivered to your inbox.
            </p>
            <div class="space-y-3">
              <input type="email" placeholder="Your email address" 
                     class="input input-bordered w-full text-gray-900">
              <button class="btn btn-secondary btn-sm w-full">Subscribe</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>